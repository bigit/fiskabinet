<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:hx="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Коды активации</title>
    <th:block th:replace="~{include::head}"/>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script type="text/javascript">
        function copyText(num) {
            let copyText = document.getElementById("val_" + num).textContent;
            navigator.clipboard.writeText(copyText);
        }
    </script>
</head>
<body>
<th:block th:replace="include::navigation"></th:block>
<div class="container shadow p-3 vh-100 h-100">
    <div class="row mb-3">
        <div class="col">
            <select name="providerId" id="ofd" class="form-select">
                <option th:each="ofd: ${ofdList}" th:text="${ofd.name}" th:value="${ofd.id}"></option>
            </select>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col">
            <input type="text" name="value">

            <input type="radio" name="duration" id="m15" value="15">
            <label for="m15">15 мес.</label>
            <input type="radio" name="duration" id="m36" value="36">
            <label for="m36">36 мес.</label>

            <input type="button" id="btn-add" value="Добавить" class="btn btn-success"
                   hx-trigger="click" hx:post="@{/code/add}" hx-target="#add_result" hx-swap="outerHTML"
                   hx-include="[name='value'],[name='duration'],[name='providerId']"/>

            <span id="add_result" th:class="${class}" th:fragment="result">[[${result == null ? "" : result}]]</span>

        </div>
    </div>
    <div class="row">
        <div class="col" id="codes_list" hx:get="@{code/free}" hx-include="[name='providerId']"
             hx-trigger="load, update from:body, change from:#ofd">
            <th:block th:fragment="codes" th:if="${codes != null}">
                <table class="table table-hover w-100">
                    <thead class="table-light">
                    <th scope="col"></th>
                    <th scope="col">Код</th>
                    <th scope="col">Срок</th>
                    <th scope="col">Статус</th>
                    </thead>
                    <tbody>
                    <tr th:each="code : ${codes}">
                        <td>
                            <button class="btn btn-outline-success" th:onclick="'copyText(' + ${code.id} + ')'"><i class="fa fa-copy"></i></button>
                            <button class="btn btn-success"><i class="fa fa-check"></i></button>
                        </td>
                        <td th:id="${'val_' + code.id}" th:text="${code.value}"></td>
                        <td th:text="${code.duration}"></td>
                        <td th:text="${code.status.description}"></td>
                    </tr>
                    </tbody>
                </table>
            </th:block>
        </div>
    </div>
</div>

</body>
</html>